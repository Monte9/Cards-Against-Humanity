var GAME_STATE = {
	gameID: 1,
	player_list: [
		{email:"iain" ,score: 10},
		{email:"player1" ,score: 14},
		{email:"player2" ,score: 9},
		{email:"player3" ,score: 4}
	],
	black_card: {id:10, text:"kid tested, mother-approved."},
	hand: [
		{id:1, text:"Being on fire."},
		{id:2, text:"Racism."},
		{id:3, text:"Old-people smell."},
		{id:4, text:"A micro&shy;penis."},
		{id:5, text:"Women in yo&shy;gurt com&shy;mercials."},
		{id:6, text:"Classit under&shy;tones."},
		{id:7, text:"Not giving a shit about the Third World."},
		{id:8, text:"Inserting a mason jar into my anus."}
	],
	vote_cards: [
		{id:1, text:"Being on fire."},
		{id:2, text:"Racism."},
		{id:3, text:"Old-people smell."},
		{id:4, text:"A micro&shy;penis."},
	],
}

var count=30;
var counter=setInterval(timer, 1000); //1000 will run it every 1 second

function timer() {
  count=count-1;
  if (count <= 0) {
     clearInterval(counter);
     return;
  }
  $('#timer').html('00:' + count);
}

function display_game_id() {
	$('#game-id').append(GAME_STATE.gameID);
}

function show_black_card(){
	$('#black-card').html("__________: " + GAME_STATE.black_card.text)
					.data("card-id", GAME_STATE.black_card.id);
}

function show_black_card_with_answer(answer){
	$('#black-card').html(answer + " " + GAME_STATE.black_card.text)
					.data("card-id", GAME_STATE.black_card.id);
}

function populate_scoreboard(){
	var scoreboard = $('#scoreboard');
	GAME_STATE.player_list.forEach(function(player){
		scoreboard.append(
			'<tr>'+
            	'<th>'+ player.email +'</th><th>'+player.score+'</th>'+
            '</tr>'
        );
	});
}

function populate_vote_cards() {
	var voting_row_1 = $('#voting-row-1');

	GAME_STATE.vote_cards.forEach(function(card, index){
		if (index == 0) {
			voting_row_1.append(
				'<div class="col-sm-2 white-card">' +
		        '<span class="white-card-text">'+card.text+'</span>' +
		        '<br/>' +
		        '<div class="vote-buttons">' +
		        '<button class="btn btn-default down-vote"><%= image_tag "Thumb-Down.png", height: "20" %></button>' +
		        '<button class="btn btn-default up-vote"><%= image_tag "Thumb-Up.png", height: "20" %></button>' +
		        '</div>' +
		        '</div>'
			);
		} else {
			voting_row_1.append(
				'<div class="col-sm-2  col-sm-offset-1 white-card">' +
		        '<span class="white-card-text">'+card.text+'</span>' +
		        '<br/>' +
		        '<div class="vote-buttons">' +
		        '<button class="btn btn-default down-vote"><%= image_tag "Thumb-Down.png", height: "20" %></button>' +
		        '<button class="btn btn-default up-vote"><%= image_tag "Thumb-Up.png", height: "20" %></button>' +
		        '</div>' +
		        '</div>'
			);
		}
	});
}

function populate_hand() {
	var hand_row_1 = $('#hand-row-1');
	var hand_row_2 = $('#hand-row-2');

	GAME_STATE.hand.forEach(function(card, index){
		var first_row = index % 2 == 0;
		if (index == 0) {
			hand_row_1.append(
				'<div class="col-sm-2 white-card">'+
                    '<span class="white-card-text" id="'+ card.id+'">'+ card.text +'</span>'+
                 '</div>'
			);
		} else if (index == 1) {
			hand_row_2.append(
				'<div class="col-sm-2 white-card">'+
                    '<span class="white-card-text" id="'+ card.id+'">'+ card.text +'</span>'+
                 '</div>'
			);
		} else if (first_row) {
			hand_row_1.append(
				'<div class="col-sm-2 col-sm-offset-1 white-card">'+
                    '<span class="white-card-text" id="'+ card.id+'">'+ card.text +'</span>'+
                 '</div>'
			);
		} else {
			hand_row_2.append(
				'<div class="col-sm-2 col-sm-offset-1 white-card">'+
                    '<span class="white-card-text" id="'+ card.id+'">'+ card.text +'</span>'+
                 '</div>'
			);
		}
	});
}

$(document).ready(function() {
	console.log('Loaded DOM');
	$('#sendChat').click(function() {
		var value = $('#chatbox').val();
		if( !value) {
			console.log("You f'ed up");
		} else {
			console.log(value);

			var URI = '/chat/message';
			var payload = {message: value, gameID: '1'};

			$.post(URI, payload, function() {
				$('#chatbox').val("");
				console.log("Made post request");
			});
		}	
	});

	$('#voting-row-1').on('click', '.up-vote', function() {
    	console.log("Up-vote button clicked. You have voted.");
    	alert("You have voted.");
    	hasVoted = true;
    	$(this).parent().remove();
	});

	$('#voting-row-1').on('click', '.down-vote', function() {
    	console.log("Down-vote button clicked. You have voted.");
    	alert("You have voted.");
    	hasVoted = true;
    	$(this).parent().remove();
	});

	$('#hand').on('click', '.white-card', function() {
		console.log("You selected the card: " + $(this).text());
		show_black_card_with_answer($(this).text());
	});

    var pusher = new Pusher('0453f37d99fca4cb4e22', {
      encrypted: true
    });

    var channel = pusher.subscribe('game_1');
    channel.bind('message_sent', function(data) {
      	$('#chat').append('<span class="user">' + data.user + ' @ </span><span class="timestamp"> ' + data.timestamp + ' </span> <br /><span class="message" style="color:red; float: right">' + data.message + '</span><br />')
    });

    display_game_id();
    show_black_card();
    populate_scoreboard();
    populate_vote_cards();
    populate_hand();
	timer();

});



